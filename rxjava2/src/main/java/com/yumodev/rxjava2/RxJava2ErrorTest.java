package com.yumodev.rxjava2;

import android.util.Log;

import com.yumo.demo.view.YmTestFragment;

import io.reactivex.Observable;
import io.reactivex.ObservableSource;
import io.reactivex.Observer;
import io.reactivex.disposables.Disposable;
import io.reactivex.functions.Function;


/**
 * Created by yumodev on 17/12/12.
 */

public class RxJava2ErrorTest extends YmTestFragment {
    /**
     * recover from an onError notification by continuing the sequence without error
     * 遇到错误的时候，发射一个特殊的项终止
     */
    public void testOnErrorReturn(){
        Observable.error(new Throwable("Test Error"))
                .onErrorReturn(new Function<Throwable, String>() {
                    @Override
                    public String apply(Throwable throwable) throws Exception {
                        return "onErrorReturn";
                    }
                })
                .subscribe(new Observer<Object>() {
                    @Override
                    public void onSubscribe(Disposable d) {
                        Log.i(Define.LOG_TAG, "onSubscribe");
                    }

                    @Override
                    public void onNext(Object o) {
                        Log.i(Define.LOG_TAG, "onNext:"+String.valueOf(o));
                    }

                    @Override
                    public void onError(Throwable e) {
                        Log.i(Define.LOG_TAG, "onError:"+e.getMessage());
                    }

                    @Override
                    public void onComplete() {
                        Log.i(Define.LOG_TAG, "onComplete");
                    }
                });
    }


    public void testOnErrorReturnItem(){
        Observable.error(new Throwable("Test Error"))
                .onErrorReturnItem("错误")
                .subscribe(new Observer<Object>() {
                    @Override
                    public void onSubscribe(Disposable d) {
                        Log.i(Define.LOG_TAG, "onSubscribe");
                    }

                    @Override
                    public void onNext(Object o) {
                        Log.i(Define.LOG_TAG, "onNext:"+String.valueOf(o));
                    }

                    @Override
                    public void onError(Throwable e) {
                        Log.i(Define.LOG_TAG, "onError:"+e.getMessage());
                    }

                    @Override
                    public void onComplete() {
                        Log.i(Define.LOG_TAG, "onComplete");
                    }
                });
    }

    public void onErrorResumeNext(){
        Observable.error(new Throwable("Test Error"))
                .onErrorResumeNext(new Function<Throwable, ObservableSource<?>>() {
                    @Override
                    public ObservableSource<?> apply(Throwable throwable) throws Exception {
                        return Observable.just(1,2,4);
                    }
                })
                .subscribe(new Observer<Object>() {
                    @Override
                    public void onSubscribe(Disposable d) {
                        Log.i(Define.LOG_TAG, "onSubscribe");
                    }

                    @Override
                    public void onNext(Object o) {
                        Log.i(Define.LOG_TAG, "onNext:"+String.valueOf(o));
                    }

                    @Override
                    public void onError(Throwable e) {
                        Log.i(Define.LOG_TAG, "onError:"+e.getMessage());
                    }

                    @Override
                    public void onComplete() {
                        Log.i(Define.LOG_TAG, "onComplete");
                    }
                });
    }

    public void onExceptionResumeNext(){
        Observable.error(new Throwable("Test Error"))
                .onExceptionResumeNext(Observable.just(1,2,3,4))
                .subscribe(new Observer<Object>() {
                    @Override
                    public void onSubscribe(Disposable d) {
                        Log.i(Define.LOG_TAG, "onSubscribe");
                    }

                    @Override
                    public void onNext(Object o) {
                        Log.i(Define.LOG_TAG, "onNext:"+String.valueOf(o));
                    }

                    @Override
                    public void onError(Throwable e) {
                        Log.i(Define.LOG_TAG, "onError:"+e.getMessage());
                    }

                    @Override
                    public void onComplete() {
                        Log.i(Define.LOG_TAG, "onComplete");
                    }
                });
    }
}
